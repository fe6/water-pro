var Be=Object.defineProperty,Ge=Object.defineProperties;var Ve=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var je=(e,t,n)=>t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,M=(e,t)=>{for(var n in t||(t={}))Re.call(t,n)&&je(e,n,t[n]);if(de)for(var n of de(t))Ce.call(t,n)&&je(e,n,t[n]);return e},Ee=(e,t)=>Ge(e,Ve(t));var z=(e,t)=>{var n={};for(var r in e)Re.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&de)for(var r of de(e))t.indexOf(r)<0&&Ce.call(e,r)&&(n[r]=e[r]);return n};import{d as He,p as Ye,g as we,k as v,o as V,v as Ke,r as ie,w as Ae,t as ze,aq as Je}from"./vendor.846be9ce.js";const Xe={},fe=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),Oe=()=>Xe;He({name:"RequestConfig",props:{config:{type:Object,required:!0}},setup(e,{slots:t}){const{config:n}=e;return Ye(fe,n),()=>{var r;return(r=t.default)===null||r===void 0?void 0:r.call(t)}}});const Ze=Object.prototype.toString,Qe=e=>Ze.call(e),qe=e=>Qe(e)==="[object String]",Te=e=>Qe(e)==="[object Object]",en=e=>Array.isArray(e),se=e=>e!==null&&typeof e=="object",nn=e=>se(e)&&Z(e.then)&&Z(e.catch),Z=e=>e instanceof Function,ve=e=>e==null,be=typeof window=="undefined",_e=()=>{var e,t;return!be&&((e=window)===null||e===void 0||(t=e.document)===null||t===void 0?void 0:t.visibilityState)==="visible"},Ne=()=>{var e,t,n;return(e=!be&&((t=window)===null||t===void 0||(n=t.navigator)===null||n===void 0?void 0:n.onLine))!==null&&e!==void 0?e:!0},tn=e=>{const t={};return Object.keys(e).forEach(n=>{t[n]=Je(e[n])}),t},le=Promise.resolve(null),me=async(...e)=>{const t=await fetch(...e);if(t.ok)return t.json();throw new Error(t.statusText)},Ie=(e,t,n=void 0)=>{const r=t.replace(/\[(\d+)\]/g,".$1").split(".");let s=e;for(const g of r)if(s=Object(s)[g],s===void 0)return n;return s};function rn(e,t){const n=Object.assign({},e);for(const r of t)delete n[r];return n}function De(e,t,n){let r,s,g,E,l,u,w=0,R=!1,I=!1,b=!0;const O=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,se(n)&&(R=!!n.leading,I="maxWait"in n,g=I?Math.max(+n.maxWait||0,t):g,b="trailing"in n?!!n.trailing:b);function P(c){const h=r,p=s;return r=s=void 0,w=c,E=e.apply(p,h),E}function T(c,h){return O?(window.cancelAnimationFrame(l),window.requestAnimationFrame(c)):setTimeout(c,h)}function C(c){if(O)return window.cancelAnimationFrame(c);clearTimeout(c)}function q(c){return w=c,l=T(j,t),R?P(c):E}function $(c){const h=c-u,p=c-w,F=t-h;return I?Math.min(F,g-p):F}function x(c){const h=c-u,p=c-w;return u===void 0||h>=t||h<0||I&&p>=g}function j(){const c=Date.now();if(x(c))return m(c);l=T(j,$(c))}function m(c){return l=void 0,b&&r?P(c):(r=s=void 0,E)}function D(){l!==void 0&&C(l),w=0,r=u=s=l=void 0}function k(){return l===void 0?E:m(Date.now())}function N(){return l!==void 0}function K(...c){const h=Date.now(),p=x(h);if(r=c,s=this,u=h,p){if(l===void 0)return q(u);if(I)return l=T(j,t),P(u)}return l===void 0&&(l=T(j,t)),E}return K.cancel=D,K.flush=k,K.pending=N,K}function an(e,t,n){let r=!0,s=!0;if(typeof e!="function")throw new TypeError("Expected a function");return se(n)&&(r="leading"in n?!!n.leading:r,s="trailing"in n?!!n.trailing:s),De(e,t,{leading:r,trailing:s,maxWait:t})}function ke(e,t){for(const n in t)if(t[n]!==void 0){if(!se(t[n])||!se(e[n])||!(n in e)){e[n]=t[n];continue}(Te(t[n])||en(t[n]))&&ke(e[n],t[n])}}function Fe(e,...t){const n=Object.assign({},e);if(!t.length)return n;for(const r of t)ke(n,r);return n}const on=(e,t)=>{let n=!1;return(...r)=>{n||(n=!0,e(...r),setTimeout(()=>{n=!1},t))}};var Pe;const Me=new Set,$e=new Set,We=new Set,ge=(e,t)=>{let n;switch(e){case"FOCUS_LISTENER":n=Me;break;case"RECONNECT_LISTENER":n=We;break;case"VISIBLE_LISTENER":n=$e;break}if(!n.has(t))return n.add(t),()=>{n.delete(t)}},Le=e=>{e.forEach(t=>{t()})};!be&&(Pe=window)!==null&&Pe!==void 0&&Pe.addEventListener&&(window.addEventListener("visibilitychange",()=>{_e()&&Le($e)},!1),window.addEventListener("focus",()=>Le(Me),!1),window.addEventListener("online",()=>Le(We),!1));const sn=(e,t)=>n=>{Object.keys(n).forEach(r=>{e[r].value=n[r]}),t.forEach(r=>r(e))},ye=(e,t,n)=>{var r,s,g;const{initialAutoRunFlag:E,initialData:l,loadingDelay:u,pollingInterval:w,debounceInterval:R,throttleInterval:I,pollingWhenHidden:b,pollingWhenOffline:O,errorRetryCount:P,errorRetryInterval:T,stopPollingWhenHiddenOrOffline:C,refreshOnWindowFocus:q,refocusTimespan:$,updateCache:x,formatResult:j,onSuccess:m,onError:D,onBefore:k,onAfter:N}=t,K=v(0),c=v((r=n==null?void 0:n.loading)!==null&&r!==void 0?r:!1),h=v((s=n==null?void 0:n.data)!==null&&s!==void 0?s:l),p=v(n==null?void 0:n.error),F=v((g=n==null?void 0:n.params)!==null&&g!==void 0?g:[]),L=sn({loading:c,data:h,error:p,params:F},[o=>x(o)]),d=()=>{K.value=0},a=v(0),f=v(),U=v(),_=v(),B=()=>{f.value&&f.value(),_.value&&_.value(),U.value&&U.value()},W=()=>{let o;return u&&(o=setTimeout(L,u,{loading:!0})),()=>o&&clearTimeout(o)},ne=o=>{if(p.value&&P!==0)return;let y;if(!ve(w)&&w>=0)if((b||_e())&&(O||Ne()))y=setTimeout(o,w);else{C.value=!0;return}return()=>y&&clearTimeout(y)},te=V(()=>{if(T)return T;const o=1e3,y=1,Q=9,Y=Math.floor(Math.random()*2**Math.min(K.value,Q)+y);return o*Y}),ue=o=>{let y;const Q=P===-1,Y=K.value<P;return p.value&&(Q||Y)&&(Q||(K.value+=1),y=setTimeout(o,te.value)),()=>y&&clearTimeout(y)},G=(...o)=>{L({loading:!u,params:o}),_.value=W(),a.value+=1;const y=a.value;return k==null||k(o),e(...o).then(Q=>{if(y===a.value){const Y=j?j(Q):Q;return L({data:Y,loading:!1,error:void 0}),m&&m(Y,o),d(),Y}return le}).catch(Q=>(y===a.value&&(L({data:void 0,loading:!1,error:Q}),D&&D(Q,o),console.error(Q)),le)).finally(()=>{y===a.value&&(_.value(),U.value=ue(()=>G(...o)),f.value=ne(()=>G(...o)),N==null||N(o))})},J=!ve(R)&&De(G,R),H=!ve(I)&&an(G,I,{leading:!0,trailing:!0}),ce=(...o)=>(B(),!E.value&&J?(J(...o),le):H?(H(...o),le):(d(),G(...o))),pe=()=>{a.value+=1,L({loading:!1}),J&&J.cancel(),H&&H.cancel(),B()},re=()=>ce(...F.value),ae=o=>{const y=Z(o)?o(h.value):o;L({data:y})},oe=[],i=o=>{o&&oe.push(o)},A=()=>{C.value&&(b||_e())&&(O||Ne())&&(re(),C.value=!1)};b||i(ge("VISIBLE_LISTENER",A)),O||i(ge("RECONNECT_LISTENER",A));const S=on(re,$);return q&&(i(ge("VISIBLE_LISTENER",S)),i(ge("FOCUS_LISTENER",S))),{loading:c,data:h,error:p,params:F,run:ce,cancel:pe,refresh:re,mutate:ae,unmount:()=>{oe.forEach(o=>o())}}},he=new Map,Se=e=>{if(ve(e))return;const t=he.get(e);if(!!t)return{data:t.data,cacheTime:t.cacheTime}},ln=(e,t,n)=>{const r=he.get(e);r!=null&&r.timer&&clearTimeout(r.timer);const s=setTimeout(()=>he.delete(e),n);he.set(e,{data:t,timer:s,cacheTime:new Date().getTime()})},ee="__QUERY_DEFAULT_KEY__";function xe(e,t){const n=we(fe,{}),{initialData:r,pollingInterval:s,debounceInterval:g,throttleInterval:E,cacheKey:l,defaultParams:u=[],manual:w=!1,ready:R=v(!0),refreshDeps:I=[],loadingDelay:b=0,pollingWhenHidden:O=!1,pollingWhenOffline:P=!1,refreshOnWindowFocus:T=!1,refocusTimespan:C=5e3,cacheTime:q=6e5,staleTime:$=0,errorRetryCount:x=0,errorRetryInterval:j=0,queryKey:m,formatResult:D,onSuccess:k,onError:N,onBefore:K,onAfter:c}=M(M(M({},Oe()),n),t),h=v(!1),p=v(!1),L={initialAutoRunFlag:p,initialData:r,loadingDelay:b,pollingInterval:s,debounceInterval:g,throttleInterval:E,pollingWhenHidden:O,pollingWhenOffline:P,stopPollingWhenHiddenOrOffline:h,cacheKey:l,errorRetryCount:x,errorRetryInterval:j,refreshOnWindowFocus:T,refocusTimespan:C,updateCache:i=>{var A,S;if(!l)return;const X=(A=Se(l))===null||A===void 0?void 0:A.data,o=X==null?void 0:X.queries,y=tn(i),Q=(S=m==null?void 0:m(...i.params.value))!==null&&S!==void 0?S:ee;ln(l,{queries:Ee(M({},o),{[Q]:M(M({},o==null?void 0:o[Q]),y)}),latestQueriesKey:Q},q)},formatResult:D,onSuccess:k,onError:N,onBefore:K,onAfter:c},d=v(!1),a=v(),f=v(),U=v(),_=ie({[ee]:ie(ye(e,L))}),B=v(ee),W=V(()=>{var i;return(i=_[B.value])!==null&&i!==void 0?i:{}});if(Ke(()=>{d.value=W.value.loading,a.value=W.value.data,f.value=W.value.error,U.value=W.value.params},{flush:"sync"}),l){var ne;const i=Se(l);i!=null&&(ne=i.data)!==null&&ne!==void 0&&ne.queries&&(Object.keys(i.data.queries).forEach(A=>{const S=i.data.queries[A];_[A]=ie(ye(e,L,{loading:S.loading,params:S.params,data:S.data,error:S.error}))}),i.data.latestQueriesKey&&(B.value=i.data.latestQueriesKey))}const te=v(),ue=v(!1),G=(...i)=>{var A;if(!R.value&&!ue.value)return te.value=i,le;const S=(A=m==null?void 0:m(...i))!==null&&A!==void 0?A:ee;return _[S]||(_[S]=ie(ye(e,L))),B.value=S,W.value.run(...i)},J=()=>{H(),B.value=ee,_[ee]=ie(ye(e,L))},H=()=>{Object.keys(_).forEach(i=>{_[i].cancel(),_[i].unmount(),delete _[i]})},ce=()=>W.value.cancel(),pe=()=>W.value.refresh(),re=i=>W.value.mutate(i);if(!w){var ae;p.value=!0;const i=Se(l),A=(ae=i==null?void 0:i.data.queries)!==null&&ae!==void 0?ae:{},S=i&&($===-1||i.cacheTime+$>new Date().getTime()),X=Object.keys(A).length>0;S||(X?Object.keys(_).forEach(o=>{var y;(y=_[o])===null||y===void 0||y.refresh()}):G(...u)),p.value=!1}const oe=v();return oe.value=Ae(R,i=>{ue.value=!0,i&&te.value&&(G(...te.value),oe.value())},{flush:"sync"}),I.length&&Ae(I,()=>{!w&&W.value.refresh()}),ze(()=>{H()}),{loading:d,data:a,error:f,params:U,cancel:ce,refresh:pe,mutate:re,run:G,reset:J,queries:_}}var Ue=e=>{let t;if(Z(e))t=(...r)=>{const s=e(...r);let g;if(nn(s))g=s;else if(Te(s)){const E=s,{url:l}=E,u=z(E,["url"]);g=me(l,u)}else if(qe(s))g=me(s);else throw new Error("Unknown service type");return new Promise((l,u)=>{g.then(l).catch(u)})};else if(Te(e)){const n=e,{url:r}=n,s=z(n,["url"]);t=()=>me(r,s)}else if(qe(e))t=()=>me(e);else throw Error("Unknown service type");return t};function dn(e,t){var n,r;const s=Ue(e),g={pagination:{currentKey:"current",pageSizeKey:"pageSize",totalKey:"total",totalPageKey:"totalPage"}},E=we(fe,{}),L=Fe(g,{pagination:(n=Oe().pagination)!==null&&n!==void 0?n:{}},{pagination:(r=E.pagination)!==null&&r!==void 0?r:{}},t!=null?t:{}),{pagination:{currentKey:l,pageSizeKey:u,totalKey:w,totalPageKey:R},queryKey:I}=L,b=z(L,["pagination","queryKey"]);if(I)throw new Error("usePagination does not support concurrent request");const O=Fe({defaultParams:[{[l]:1,[u]:10}]},b),d=xe(s,O),{data:P,params:T,queries:C,run:q,reset:$}=d,x=z(d,["data","params","queries","run","reset"]),j=a=>{const[f,...U]=T.value,B=[M(M({},f),a),...U];q(...B)},m=a=>{j({[l]:a})},D=a=>{j({[u]:a})},k=(a,f)=>{j({[l]:a,[u]:f})},N=v(!1),K=async()=>{const{defaultParams:a,manual:f}=O;$(),f||(N.value=!0,await q(...a),N.value=!1)},c=V(()=>Ie(P.value,w,0)),h=V({get:()=>{var a,f;return(a=(f=T.value[0])===null||f===void 0?void 0:f[l])!==null&&a!==void 0?a:O.defaultParams[0][l]},set:a=>{m(a)}}),p=V({get:()=>{var a,f;return(a=(f=T.value[0])===null||f===void 0?void 0:f[u])!==null&&a!==void 0?a:O.defaultParams[0][u]},set:a=>{D(a)}}),F=V(()=>Ie(P.value,R,Math.ceil(c.value/p.value)));return M({data:P,params:T,current:h,pageSize:p,total:c,totalPage:F,reloading:N,run:q,changeCurrent:m,changePageSize:D,changePagination:k,reload:K},x)}function fn(e,t){var n;if(!Z(e))throw new Error("useLoadMore only support function service");const r=Ue(e),s=we(fe,{}),F=Object.assign({listKey:(n=s.listKey)!==null&&n!==void 0?n:Oe().listKey},t!=null?t:{}),{queryKey:g,isNoMore:E,listKey:l="list"}=F,u=z(F,["queryKey","isNoMore","listKey"]);if(g)throw new Error("useLoadMore does not support concurrent request");const w=v(!1),R=v(!1),I=v(!1),b=0,O=v(b),L=xe(r,Ee(M({},u),{onSuccess:(...d)=>{var a;R.value=!1,O.value++,u==null||(a=u.onSuccess)===null||a===void 0||a.call(u,...d)},onError:(...d)=>{var a;R.value=!1,u==null||(a=u.onError)===null||a===void 0||a.call(u,...d)},queryKey:()=>String(O.value)})),{data:P,params:T,queries:C,run:q,reset:$,cancel:x}=L,j=z(L,["data","params","queries","run","reset","cancel"]),m=v(P.value);Ke(()=>{P.value!==void 0&&(m.value=P.value)});const D=V(()=>E&&Z(E)?E(m.value):!1),k=V(()=>{let d=[];return Object.values(C).forEach(a=>{const f=Ie(a.data,l);f&&Array.isArray(f)&&(d=d.concat(f))}),d}),N=()=>{if(D.value)return;R.value=!0;const[,...d]=T.value,a=[{dataList:k.value,data:m.value},...d];q(...a)},K=()=>{Object.keys(C).forEach(d=>{d!==b.toString()&&(C[d].cancel(),C[d].unmount(),delete C[d])})};return M({data:m,dataList:k,params:T,noMore:D,loadingMore:R,refreshing:w,reloading:I,run:q,reload:async()=>{I.value=!0,$(),O.value=b,m.value=void 0;const[,...d]=T.value,a=[void 0,...d];await q(...a),I.value=!1},loadMore:N,reset:$,refresh:async()=>{w.value=!0;const d=O.value-1,a=d<b?b:d;m.value=C[a].data,O.value=b;const[,...f]=T.value,U=[void 0,...f];await q(...U),K(),w.value=!1},cancel:()=>{x(),R.value=!1,w.value=!1}},rn(j,["refresh","mutate"]))}export{fn as a,dn as u};
