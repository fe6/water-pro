var Be=Object.defineProperty,Ve=Object.defineProperties;var He=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var Ke=(e,t,n)=>t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,F=(e,t)=>{for(var n in t||(t={}))Ce.call(t,n)&&Ke(e,n,t[n]);if(ue)for(var n of ue(t))je.call(t,n)&&Ke(e,n,t[n]);return e},pe=(e,t)=>Ve(e,He(t));var J=(e,t)=>{var n={};for(var a in e)Ce.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&ue)for(var a of ue(e))t.indexOf(a)<0&&je.call(e,a)&&(n[a]=e[a]);return n};import{d as Ye,p as ze,b as ye,k as m,y as Je,c as U,r as te,w as he,h as Xe,u as Ze}from"./vendor.d8741e22.js";const en={},ce=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),Ee=()=>en;Ye({name:"RequestConfig",props:{config:{type:Object,required:!0}},setup(e,{slots:t}){const{config:n}=e;return ze(ce,n),()=>{var a;return(a=t.default)===null||a===void 0?void 0:a.call(t)}}});const nn=Object.prototype.toString,Ae=e=>nn.call(e),tn=e=>Ae(e)==="[object String]",Ne=e=>Ae(e)==="[object Object]",an=e=>Array.isArray(e),ae=e=>e!==null&&typeof e=="object",rn=e=>ae(e)&&Z(e.then)&&Z(e.catch),Z=e=>e instanceof Function,de=e=>e==null,Oe=typeof window=="undefined",Te=()=>{var e,t;return!Oe&&((e=window)===null||e===void 0||(t=e.document)===null||t===void 0?void 0:t.visibilityState)==="visible"},Qe=()=>{var e,t,n;return(e=!Oe&&((t=window)===null||t===void 0||(n=t.navigator)===null||n===void 0?void 0:n.onLine))!==null&&e!==void 0?e:!0},on=e=>{const t={};return Object.keys(e).forEach(n=>{t[n]=Ze(e[n])}),t},re=Promise.resolve(null),qe=async(...e)=>{const t=await fetch(...e);if(t.ok)return t.json();throw new Error(t.statusText)},be=(e,t,n=void 0)=>{const a=t.replace(/\[(\d+)\]/g,".$1").split(".");let d=e;for(const w of a)if(d=Object(d)[w],d===void 0)return n;return d};function Fe(e,t){const n=Object.assign({},e);for(const a of t)delete n[a];return n}const fe=(e,t=!1)=>{const n=`Warning: [vue-request] ${e}`;if(t)return new Error(n);console.error(n)},sn=(e,t)=>{let n=!1;return(...a)=>{n||(n=!0,e(...a),setTimeout(()=>{n=!1},t))}};var we;const $e=new Set,ke=new Set,Me=new Set,ve=(e,t)=>{let n;switch(e){case"FOCUS_LISTENER":n=$e;break;case"RECONNECT_LISTENER":n=Me;break;case"VISIBLE_LISTENER":n=ke;break}if(!n.has(t))return n.add(t),()=>{n.delete(t)}},_e=e=>{e.forEach(t=>{t()})};!Oe&&(we=window)!==null&&we!==void 0&&we.addEventListener&&(window.addEventListener("visibilitychange",()=>{Te()&&_e(ke)},!1),window.addEventListener("focus",()=>_e($e),!1),window.addEventListener("online",()=>_e(Me),!1));function De(e,t,n){let a,d,w,_,f,c,E=0,S=!1,R=!1,L=!0;const P=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,ae(n)&&(S=!!n.leading,R="maxWait"in n,w=R?Math.max(+n.maxWait||0,t):w,L="trailing"in n?!!n.trailing:L);function O(i){const l=a,y=d;return a=d=void 0,E=i,_=e.apply(y,l),_}function g(i,l){return P?(window.cancelAnimationFrame(f),window.requestAnimationFrame(i)):setTimeout(i,l)}function C(i){if(P)return window.cancelAnimationFrame(i);clearTimeout(i)}function p(i){return E=i,f=g(I,t),S?O(i):_}function $(i){const l=i-c,y=i-E,T=t-l;return R?Math.min(T,w-y):T}function W(i){const l=i-c,y=i-E;return c===void 0||l>=t||l<0||R&&y>=w}function I(){const i=Date.now();if(W(i))return j(i);f=g(I,$(i))}function j(i){return f=void 0,L&&a?O(i):(a=d=void 0,_)}function K(){f!==void 0&&C(f),E=0,a=c=d=f=void 0}function k(){return f===void 0?_:j(Date.now())}function q(){return f!==void 0}function A(...i){const l=Date.now(),y=W(l);if(a=i,d=this,c=l,y){if(f===void 0)return p(c);if(R)return f=g(I,t),O(c)}return f===void 0&&(f=g(I,t)),_}return A.cancel=K,A.flush=k,A.pending=q,A}function We(e,t){for(const n in t)if(t[n]!==void 0){if(!ae(t[n])||!ae(e[n])||!(n in e)){e[n]=t[n];continue}(Ne(t[n])||an(t[n]))&&We(e[n],t[n])}}function xe(e,...t){const n=Object.assign({},e);if(!t.length)return n;for(const a of t)We(n,a);return n}function ln(e,t,n){let a=!0,d=!0;if(typeof e!="function")throw new TypeError("Expected a function");return ae(n)&&(a="leading"in n?!!n.leading:a,d="trailing"in n?!!n.trailing:d),De(e,t,{leading:a,trailing:d,maxWait:t})}const un=(e,t)=>n=>{Object.keys(n).forEach(a=>{e[a].value=n[a]}),t.forEach(a=>a(e))},me=(e,t,n)=>{var a,d,w;const{initialAutoRunFlag:_,initialData:f,loadingDelay:c,pollingInterval:E,debounceInterval:S,debounceOptions:R,throttleInterval:L,throttleOptions:P,pollingWhenHidden:O,pollingWhenOffline:g,errorRetryCount:C,errorRetryInterval:p,stopPollingWhenHiddenOrOffline:$,refreshOnWindowFocus:W,refocusTimespan:I,updateCache:j,formatResult:K,onSuccess:k,onError:q,onBefore:A,onAfter:i}=t,l=m(0),y=m((a=n==null?void 0:n.loading)!==null&&a!==void 0?a:!1),T=m((d=n==null?void 0:n.data)!==null&&d!==void 0?d:f),Q=m(n==null?void 0:n.error),u=m((w=n==null?void 0:n.params)!==null&&w!==void 0?w:[]),r=un({loading:y,data:T,error:Q,params:u},[s=>j(s)]),v=()=>{l.value=0},M=m(0),B=m(),V=m(),X=m(),oe=()=>{B.value&&B.value(),X.value&&X.value(),V.value&&V.value()},ne=()=>{let s;return c&&(s=setTimeout(r,c,{loading:!0})),()=>s&&clearTimeout(s)},ie=s=>{if(Q.value&&C!==0)return;let N;if(!de(E)&&E>=0)if((O||Te())&&(g||Qe()))N=setTimeout(s,E);else{$.value=!0;return}return()=>N&&clearTimeout(N)},se=U(()=>{if(p)return p;const s=1e3,N=1,D=9,z=Math.floor(Math.random()*2**Math.min(l.value,D)+N);return s*z}),o=s=>{let N;const D=C===-1,z=l.value<C;return Q.value&&(D||z)&&(D||(l.value+=1),N=setTimeout(s,se.value)),()=>N&&clearTimeout(N)},b=(...s)=>{r({loading:!c,params:s}),X.value=ne(),M.value+=1;const N=M.value;return A==null||A(s),e(...s).then(D=>{if(N===M.value){const z=K?K(D):D;return r({data:z,loading:!1,error:void 0}),k&&k(z,s),v(),z}return re}).catch(D=>(N===M.value&&(r({data:void 0,loading:!1,error:D}),q&&q(D,s),console.error(D)),re)).finally(()=>{N===M.value&&(X.value(),V.value=o(()=>b(...s)),B.value=ie(()=>b(...s)),i==null||i(s))})},h=!de(S)&&De(b,S,R),x=!de(L)&&ln(b,L,P),G=(...s)=>(oe(),!_.value&&h?(h(...s),re):x?(x(...s),re):(v(),b(...s))),H=()=>{M.value+=1,r({loading:!1}),h&&h.cancel(),x&&x.cancel(),oe()},Y=()=>G(...u.value),Ue=s=>{const N=Z(s)?s(T.value):s;r({data:N})},Ie=[],le=s=>{s&&Ie.push(s)},Se=()=>{$.value&&(O||Te())&&(g||Qe())&&(Y(),$.value=!1)};O||le(ve("VISIBLE_LISTENER",Se)),g||le(ve("RECONNECT_LISTENER",Se));const Re=sn(Y,I);return W&&(le(ve("VISIBLE_LISTENER",Re)),le(ve("FOCUS_LISTENER",Re))),{loading:y,data:T,error:Q,params:u,run:G,cancel:H,refresh:Y,mutate:Ue,unmount:()=>{Ie.forEach(s=>s())}}},ge=new Map,Le=e=>{if(de(e))return;const t=ge.get(e);if(!!t)return{data:t.data,cacheTime:t.cacheTime}},cn=(e,t,n)=>{const a=ge.get(e);a!=null&&a.timer&&clearTimeout(a.timer);const d=setTimeout(()=>ge.delete(e),n);ge.set(e,{data:t,timer:d,cacheTime:new Date().getTime()})},ee="__QUERY_DEFAULT_KEY__";function Ge(e,t){const n=ye(ce,{}),se=F(F(F({},Ee()),n),t),{cacheKey:a,defaultParams:d=[],manual:w=!1,ready:_=m(!0),refreshDeps:f=[],loadingDelay:c=0,pollingWhenHidden:E=!1,pollingWhenOffline:S=!1,refreshOnWindowFocus:R=!1,refocusTimespan:L=5e3,cacheTime:P=6e5,staleTime:O=0,errorRetryCount:g=0,errorRetryInterval:C=0,queryKey:p}=se,$=J(se,["cacheKey","defaultParams","manual","ready","refreshDeps","loadingDelay","pollingWhenHidden","pollingWhenOffline","refreshOnWindowFocus","refocusTimespan","cacheTime","staleTime","errorRetryCount","errorRetryInterval","queryKey"]),W=m(!1),I=m(!1),K=F({initialAutoRunFlag:I,loadingDelay:c,pollingWhenHidden:E,pollingWhenOffline:S,stopPollingWhenHiddenOrOffline:W,cacheKey:a,errorRetryCount:g,errorRetryInterval:C,refreshOnWindowFocus:R,refocusTimespan:L,updateCache:o=>{var b,h;if(!a)return;const x=(b=Le(a))===null||b===void 0?void 0:b.data,G=x==null?void 0:x.queries,H=on(o),Y=(h=p==null?void 0:p(...o.params.value))!==null&&h!==void 0?h:ee;cn(a,{queries:pe(F({},G),{[Y]:F(F({},G==null?void 0:G[Y]),H)}),latestQueriesKey:Y},P)}},Fe($,["pagination","listKey"])),k=m(!1),q=m(),A=m(),i=m(),l=te({[ee]:te(me(e,K))}),y=m(ee),T=U(()=>{var o;return(o=l[y.value])!==null&&o!==void 0?o:{}});if(he(T,o=>{k.value=o.loading,q.value=o.data,A.value=o.error,i.value=o.params},{immediate:!0,deep:!0}),a){var Q;const o=Le(a);o!=null&&(Q=o.data)!==null&&Q!==void 0&&Q.queries&&(Object.keys(o.data.queries).forEach(b=>{const h=o.data.queries[b];l[b]=te(me(e,K,{loading:h.loading,params:h.params,data:h.data,error:h.error}))}),o.data.latestQueriesKey&&(y.value=o.data.latestQueriesKey))}const u=m(),r=m(!1),v=(...o)=>{var b;if(!_.value&&!r.value)return u.value=o,re;const h=(b=p==null?void 0:p(...o))!==null&&b!==void 0?b:ee;return l[h]||(l[h]=te(me(e,K))),y.value=h,T.value.run(...o)},M=()=>{B(),y.value=ee,l[ee]=te(me(e,K))},B=()=>{Object.keys(l).forEach(o=>{l[o].cancel(),l[o].unmount(),delete l[o]})},V=()=>T.value.cancel(),X=()=>T.value.refresh(),oe=o=>T.value.mutate(o);if(!w){var ne;I.value=!0;const o=Le(a),b=(ne=o==null?void 0:o.data.queries)!==null&&ne!==void 0?ne:{},h=o&&(O===-1||o.cacheTime+O>new Date().getTime()),x=Object.keys(b).length>0;h||(x?Object.keys(l).forEach(G=>{var H;(H=l[G])===null||H===void 0||H.refresh()}):v(...d)),I.value=!1}const ie=m();return ie.value=he(_,o=>{r.value=!0,o&&u.value&&(v(...u.value),ie.value())},{flush:"sync"}),f.length&&he(f,()=>{!w&&T.value.refresh()}),Xe(()=>{B()}),{loading:k,data:q,error:A,params:i,cancel:V,refresh:X,mutate:oe,run:v,reset:M,queries:l}}const Pe=e=>(...t)=>{if(Z(e))return Pe(e(...t))();if(rn(e))return e;if(Ne(e)){const n=e,{url:a}=n,d=J(n,["url"]);return qe(a,d)}else{if(tn(e))return qe(e);throw fe("Unknown service type",!0)}};function mn(e,t){var n;Z(e)||fe("useLoadMore only support function service");const a=Pe(e),d=ye(ce,{}),T=Object.assign({listKey:(n=d.listKey)!==null&&n!==void 0?n:Ee().listKey},t!=null?t:{}),{queryKey:w,isNoMore:_,listKey:f="list"}=T,c=J(T,["queryKey","isNoMore","listKey"]);w&&fe("useLoadMore does not support concurrent request");const E=m(!1),S=m(!1),R=m(!1),L=0,P=m(L),Q=Ge(a,pe(F({},c),{onSuccess:(...u)=>{var r;S.value=!1,P.value++,c==null||(r=c.onSuccess)===null||r===void 0||r.call(c,...u)},onError:(...u)=>{var r;S.value=!1,c==null||(r=c.onError)===null||r===void 0||r.call(c,...u)},queryKey:()=>String(P.value)})),{data:O,params:g,queries:C,run:p,reset:$,cancel:W}=Q,I=J(Q,["data","params","queries","run","reset","cancel"]),j=m(O.value);Je(()=>{O.value!==void 0&&(j.value=O.value)});const K=U(()=>_&&Z(_)?_(j.value):!1),k=U(()=>{let u=[];return Object.values(C).forEach(r=>{const v=be(r.data,f);v&&Array.isArray(v)&&(u=u.concat(v))}),u}),q=()=>{if(K.value)return;S.value=!0;const[,...u]=g.value,r=[{dataList:k.value,data:j.value},...u];p(...r)},A=()=>{Object.keys(C).forEach(u=>{u!==L.toString()&&(C[u].cancel(),C[u].unmount(),delete C[u])})};return F({data:j,dataList:k,params:g,noMore:K,loadingMore:S,refreshing:E,reloading:R,run:p,reload:async()=>{R.value=!0,$(),P.value=L,j.value=void 0;const[,...u]=g.value,r=[void 0,...u];await p(...r),R.value=!1},loadMore:q,reset:$,refresh:async()=>{E.value=!0;const u=P.value-1,r=u<L?L:u;j.value=C[r].data,P.value=L;const[,...v]=g.value,M=[void 0,...v];await p(...M),A(),E.value=!1},cancel:()=>{W(),S.value=!1,E.value=!1}},Fe(I,["refresh","mutate"]))}function gn(e,t){var n,a;const d=Pe(e),w={pagination:{currentKey:"current",pageSizeKey:"pageSize",totalKey:"total",totalPageKey:"totalPage"}},_=ye(ce,{}),Q=xe(w,{pagination:(n=Ee().pagination)!==null&&n!==void 0?n:{}},{pagination:(a=_.pagination)!==null&&a!==void 0?a:{}},t!=null?t:{}),{pagination:{currentKey:f,pageSizeKey:c,totalKey:E,totalPageKey:S},queryKey:R}=Q,L=J(Q,["pagination","queryKey"]);R&&fe("usePagination does not support concurrent request");const P=xe({defaultParams:[{[f]:1,[c]:10}]},L),u=Ge(d,P),{data:O,params:g,queries:C,run:p,reset:$}=u,W=J(u,["data","params","queries","run","reset"]),I=r=>{const[v,...M]=g.value,V=[F(F({},v),r),...M];p(...V)},j=r=>{I({[f]:r})},K=r=>{I({[c]:r})},k=(r,v)=>{I({[f]:r,[c]:v})},q=m(!1),A=async()=>{const{defaultParams:r,manual:v}=P;$(),v||(q.value=!0,await p(...r),q.value=!1)},i=U(()=>be(O.value,E,0)),l=U({get:()=>{var r,v;return(r=(v=g.value[0])===null||v===void 0?void 0:v[f])!==null&&r!==void 0?r:P.defaultParams[0][f]},set:r=>{j(r)}}),y=U({get:()=>{var r,v;return(r=(v=g.value[0])===null||v===void 0?void 0:v[c])!==null&&r!==void 0?r:P.defaultParams[0][c]},set:r=>{K(r)}}),T=U(()=>be(O.value,S,Math.ceil(i.value/y.value)));return F({data:O,params:g,current:l,pageSize:y,total:i,totalPage:T,reloading:q,run:p,changeCurrent:j,changePageSize:K,changePagination:k,reload:A},W)}export{gn as a,mn as u};
